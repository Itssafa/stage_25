<div class="auth-container">
  <div class="auth-card">
    <!-- En-t√™te avec logo -->
    <div class="auth-header">
      <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#764ba2;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#f093fb;stop-opacity:1" />
          </linearGradient>
        </defs>
        <circle cx="50" cy="50" r="45" fill="url(#logoGradient)" opacity="0.2"/>
        <path d="M30 50 L50 30 L70 50 L50 70 Z" fill="url(#logoGradient)" />
        <circle cx="50" cy="50" r="8" fill="white"/>
      </svg>
      <h1>Cr√©er un compte</h1>
      <p>Rejoignez ProdLine aujourd'hui</p>
    </div>
    
    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form">
      
      <!-- Nom d'utilisateur -->
      <div class="form-group">
        <label for="username">
          Nom d'utilisateur
          <span class="required">*</span>
        </label>
        <div class="input-with-icon">
          <input
            type="text"
            id="username"
            formControlName="username"
            class="form-input"
            [class.error]="registerForm.get('username')?.touched && registerForm.get('username')?.invalid"
            [class.success]="registerForm.get('username')?.touched && registerForm.get('username')?.valid"
            placeholder="Choisissez un nom d'utilisateur"
          >
          <span class="input-icon success" *ngIf="registerForm.get('username')?.touched && registerForm.get('username')?.valid">‚úì</span>
          <span class="input-icon error" *ngIf="registerForm.get('username')?.touched && registerForm.get('username')?.invalid">‚úï</span>
        </div>
        <div class="field-help error" *ngIf="registerForm.get('username')?.touched && registerForm.get('username')?.errors">
          <span *ngIf="registerForm.get('username')?.errors?.['required']">Le nom d'utilisateur est requis</span>
          <span *ngIf="registerForm.get('username')?.errors?.['minlength']">Minimum 3 caract√®res requis</span>
        </div>
      </div>
      
      <!-- Pr√©nom -->
      <div class="form-group">
        <label for="prenom">
          Pr√©nom
          <span class="required">*</span>
        </label>
        <div class="input-with-icon">
          <input
            type="text"
            id="prenom"
            formControlName="prenom"
            class="form-input"
            [class.error]="registerForm.get('prenom')?.touched && registerForm.get('prenom')?.invalid"
            [class.success]="registerForm.get('prenom')?.touched && registerForm.get('prenom')?.valid"
            placeholder="Votre pr√©nom"
          >
          <span class="input-icon success" *ngIf="registerForm.get('prenom')?.touched && registerForm.get('prenom')?.valid">‚úì</span>
          <span class="input-icon error" *ngIf="registerForm.get('prenom')?.touched && registerForm.get('prenom')?.invalid">‚úï</span>
        </div>
        <div class="field-help error" *ngIf="registerForm.get('prenom')?.touched && registerForm.get('prenom')?.errors?.['required']">
          Le pr√©nom est requis
        </div>
      </div>
      
      <!-- T√©l√©phone -->
      <div class="form-group">
        <label for="telephone">
          Num√©ro de t√©l√©phone
          <span class="required">*</span>
        </label>
        <div class="input-with-icon">
          <input
            type="tel"
            id="telephone"
            formControlName="telephone"
            class="form-input"
            [class.error]="registerForm.get('telephone')?.touched && registerForm.get('telephone')?.invalid"
            [class.success]="registerForm.get('telephone')?.touched && registerForm.get('telephone')?.valid"
            placeholder="+33 6 12 34 56 78"
          >
          <span class="input-icon success" *ngIf="registerForm.get('telephone')?.touched && registerForm.get('telephone')?.valid">‚úì</span>
          <span class="input-icon error" *ngIf="registerForm.get('telephone')?.touched && registerForm.get('telephone')?.invalid">‚úï</span>
        </div>
        <div class="field-help error" *ngIf="registerForm.get('telephone')?.touched && registerForm.get('telephone')?.errors">
          <span *ngIf="registerForm.get('telephone')?.errors?.['required']">Le num√©ro de t√©l√©phone est requis</span>
          <span *ngIf="registerForm.get('telephone')?.errors?.['pattern']">Format de t√©l√©phone invalide</span>
        </div>
      </div>
      
      <!-- Section Email avec V√©rification -->
      <div class="form-group email-verification-section">
        <label for="email">
          Adresse email
          <span class="required">*</span>
        </label>
        
        <!-- Champ email + Bouton envoyer -->
        <div class="email-input-wrapper">
          <div class="input-with-icon" style="flex: 1;">
            <input
              type="email"
              id="email"
              formControlName="adresseMail"
              class="form-input"
              [class.error]="registerForm.get('adresseMail')?.touched && registerForm.get('adresseMail')?.invalid"
              [class.success]="emailVerified"
              placeholder="votre@email.com"
              [disabled]="emailCodeSent"
            >
            <span class="input-icon success" *ngIf="emailVerified">‚úì</span>
            <span class="input-icon error" *ngIf="registerForm.get('adresseMail')?.touched && registerForm.get('adresseMail')?.invalid && !emailCodeSent">‚úï</span>
          </div>
          <button
            type="button"
            class="btn-send-code"
            (click)="sendVerificationCode()"
            [disabled]="emailCodeSent || registerForm.get('adresseMail')?.invalid || loading"
          >
            <span *ngIf="!emailCodeSent">Envoyer le code</span>
            <span *ngIf="emailCodeSent">Code envoy√©</span>
          </button>
        </div>

        <!-- Erreurs email -->
        <div class="field-help error" *ngIf="registerForm.get('adresseMail')?.touched && registerForm.get('adresseMail')?.errors && !emailCodeSent">
          <span *ngIf="registerForm.get('adresseMail')?.errors?.['required']">L'adresse email est requise</span>
          <span *ngIf="registerForm.get('adresseMail')?.errors?.['email']">Format d'email invalide</span>
        </div>

        <!-- Zone de v√©rification du code -->
        <div class="verification-card" *ngIf="emailCodeSent && !emailVerified">
          <div class="verification-card-header">
            <h4>Code de v√©rification envoy√©</h4>
            <p>Un code √† 6 chiffres a √©t√© envoy√© √† <strong>{{ registerForm.get('adresseMail')?.value }}</strong></p>
          </div>
          
          <div class="verification-card-body">
            <div class="code-input-wrapper">
              <input
                type="text"
                id="verificationCode"
                [(ngModel)]="enteredCode"
                [ngModelOptions]="{standalone: true}"
                class="code-input"
                placeholder="000000"
                maxlength="6"
                (keypress)="onlyNumbers($event)"
              >
            </div>

            <div class="verification-actions">
              <button 
                type="button" 
                class="btn-verify"
                (click)="verifyEmailCode()"
                [disabled]="enteredCode.length !== 6 || loading"
              >
                <span *ngIf="!loading">V√©rifier le code</span>
                <span *ngIf="loading">V√©rification en cours</span>
              </button>

              <button 
                type="button" 
                class="btn-resend"
                (click)="resendVerificationCode()"
                [disabled]="loading"
              >
                Renvoyer le code
              </button>
            </div>

            <!-- Message d'erreur -->
            <div class="verification-error" *ngIf="codeError">
              <p>{{ codeError }}</p>
            </div>
          </div>
        </div>

        <!-- Message de succ√®s (email v√©rifi√©) -->
        <div class="verification-success" *ngIf="emailVerified">
          <div class="success-checkmark">
            <div class="checkmark-circle"></div>
            <div class="checkmark-stem"></div>
            <div class="checkmark-kick"></div>
          </div>
          <p>Email v√©rifi√© avec succ√®s</p>
        </div>
      </div>
      
      <!-- Mot de passe -->
      <div class="form-group">
        <label for="password">
          Mot de passe
          <span class="required">*</span>
        </label>
        <div class="password-field">
          <input
            [type]="hidePassword ? 'password' : 'text'"
            id="password"
            formControlName="motDePasse"
            class="form-input"
            [class.error]="registerForm.get('motDePasse')?.touched && registerForm.get('motDePasse')?.invalid"
            [class.success]="registerForm.get('motDePasse')?.touched && registerForm.get('motDePasse')?.valid"
            placeholder="Cr√©ez un mot de passe s√©curis√©"
          >
          <button
            type="button"
            class="password-toggle"
            (click)="hidePassword = !hidePassword"
            tabindex="-1"
          >
            <span *ngIf="hidePassword">üëÅ</span>
            <span *ngIf="!hidePassword">üëÅ‚Äçüó®</span>
          </button>
        </div>
        <div class="field-help info">
          Minimum 8 caract√®res, incluant minuscule, majuscule et caract√®re sp√©cial
        </div>
        <div class="field-help error" *ngIf="registerForm.get('motDePasse')?.touched && registerForm.get('motDePasse')?.errors">
          <span *ngIf="registerForm.get('motDePasse')?.errors?.['required']">Le mot de passe est requis</span>
          <span *ngIf="registerForm.get('motDePasse')?.errors?.['minlength']">Minimum 8 caract√®res requis</span>
          <span *ngIf="registerForm.get('motDePasse')?.errors?.['pattern']">Doit contenir minuscule, majuscule et caract√®re sp√©cial</span>
        </div>
      </div>

      <!-- Confirmation du mot de passe -->
      <div class="form-group">
        <label for="confirmPassword">
          Confirmer le mot de passe
          <span class="required">*</span>
        </label>
        <div class="password-field">
          <input
            [type]="hideConfirmPassword ? 'password' : 'text'"
            id="confirmPassword"
            formControlName="confirmMotDePasse"
            class="form-input"
            [class.error]="(registerForm.get('confirmMotDePasse')?.touched && registerForm.get('confirmMotDePasse')?.invalid) || (registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmMotDePasse')?.touched)"
            [class.success]="registerForm.get('confirmMotDePasse')?.touched && registerForm.get('confirmMotDePasse')?.valid && !registerForm.errors?.['passwordMismatch']"
            placeholder="Retapez votre mot de passe"
          >
          <button
            type="button"
            class="password-toggle"
            (click)="hideConfirmPassword = !hideConfirmPassword"
            tabindex="-1"
          >
            <span *ngIf="hideConfirmPassword">üëÅ</span>
            <span *ngIf="!hideConfirmPassword">üëÅ‚Äçüó®</span>
          </button>
        </div>
        <div class="field-help error" *ngIf="registerForm.get('confirmMotDePasse')?.touched && registerForm.get('confirmMotDePasse')?.errors?.['required']">
          La confirmation du mot de passe est requise
        </div>
        <div class="field-help error" *ngIf="registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmMotDePasse')?.touched">
          Les mots de passe ne correspondent pas
        </div>
      </div>
      
      <!-- Messages d'√©tat globaux -->
      <div class="alert-message error" *ngIf="errorMessage">
        <div class="alert-content">
          <span class="alert-icon">‚úï</span>
          <span class="alert-text">{{ errorMessage }}</span>
        </div>
      </div>
      
      <div class="alert-message success" *ngIf="successMessage">
        <div class="alert-content">
          <span class="alert-icon">‚úì</span>
          <span class="alert-text">{{ successMessage }}</span>
        </div>
      </div>
      
      <!-- Message d'information pour la v√©rification email -->
      <div class="info-banner" *ngIf="!emailVerified && registerForm.valid">
        <div class="info-banner-content">
          <div class="info-banner-icon">üîí</div>
          <div class="info-banner-text">
            <strong>V√©rification requise</strong>
            <p>V√©rifiez votre email pour activer la cr√©ation de compte</p>
          </div>
        </div>
      </div>
      
      <!-- Bouton de cr√©ation de compte -->
      <button
        type="submit"
        class="btn-primary"
        [disabled]="loading || registerForm.invalid || !emailVerified"
      >
        <span class="btn-content">
          <span *ngIf="!loading">Cr√©er mon compte</span>
          <span *ngIf="loading" class="loading-text">
            <span class="loading-spinner"></span>
            Cr√©ation en cours
          </span>
        </span>
      </button>

      <!-- Indicateur de statut du formulaire -->
      <div class="form-status">
        <div class="status-indicator" *ngIf="registerForm.invalid">
          <span class="status-dot error"></span>
          <span class="status-text">Veuillez remplir tous les champs requis</span>
        </div>
        <div class="status-indicator" *ngIf="registerForm.valid && !emailVerified">
          <span class="status-dot warning"></span>
          <span class="status-text">V√©rification de l'email requise</span>
        </div>
        <div class="status-indicator" *ngIf="registerForm.valid && emailVerified">
          <span class="status-dot success"></span>
          <span class="status-text">Formulaire pr√™t √† √™tre soumis</span>
        </div>
      </div>
    </form>
    
    <!-- Pied de page -->
    <div class="auth-footer">
      <p>Vous avez d√©j√† un compte ?</p>
      <button type="button" class="btn-secondary" (click)="navigateToLogin()">
        Se connecter
      </button>
    </div>
  </div>
</div>